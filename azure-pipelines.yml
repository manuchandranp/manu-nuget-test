# azure-pipelines.yml
parameters:
  - name: BuildConfiguration
    displayName: 'Build Configuration'
    type: string
    default: 'Release'
    values:
      - 'Release'
      - 'Debug'

jobs:
  - job: BuildAndPublish
    displayName: 'Build and Publish to Artifactory'
    pool:
      vmImage: 'windows-latest'
    steps:
      # Checkout the source code
      - checkout: self

      # Use the specific .NET SDK version required by your project
      - task: UseDotNet@2
        displayName: 'Install .NET SDK'
        inputs:
          packageType: 'sdk'
          version: '6.x'  # Adjust version as needed
          installationPath: $(Agent.ToolsDirectory)/dotnet

      # Restore NuGet packages
      - task: DotNetCoreCLI@2
        displayName: 'Restore NuGet Packages'
        inputs:
          command: 'restore'
          projects: '**/*.csproj'  # Adjust if needed

      # Execute JFrogDotnetCore task to install dependencies
      - task: JFrogDotnetCore@1
        displayName: 'Install Dependencies'
        inputs:
          command: 'custom'
          customCommand: 'workload'
          arguments: 'install maui-desktop maui-ios'
          artifactoryConnection: 'crm-terraform-us-jfrog-artifactory-private-ep'
          targetResolveRepo: 'manu-nuget-virtual'
          rootPath: '$(Build.SourcesDirectory)'

      # Optionally, Publish artifacts if needed
      - task: PublishBuildArtifacts@1
        displayName: 'Publish Artifacts'
        inputs:
          pathToPublish: '$(Build.SourcesDirectory)/path-to-artifacts'  # Adjust accordingly
          artifactName: 'NuGetArtifacts'
          publishLocation: 'Container'